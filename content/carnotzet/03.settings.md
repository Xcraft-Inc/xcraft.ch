---
title: 'Paramétrage'
weight: 30
tags: ['carnotzet', 'os', 'settings']
pre: '<b>5.3 </b>'
---

La configuration de base de **Carnotzet OS** se trouve dans la partition FAT32
de la carte µSD. Pour la découvrir il suffit de connecter votre carte sur votre
ordinateur, un nouveau périphérique nommé `BOOT` devrait se monter dans votre
système. Faites bien attention, ceci est la partition de démarrage de
**Carnotzet OS**. Il n'y a que deux fichiers que je vous autorise à modifier à
la main. Ce sont les fichiers `carnotzet.cfg` ainsi que le fichier
`sources.list`.

> Les configurations sont bien entendu accessibles directement depuis
> **Carnotzet OS**. Il n'est pas forcément nécessaire d'accéder à la partition
> de démarrage depuis un ordinateur tiers.

Si vous utilisez Linux, une seconde partition pourrait être montée, c'est la
partition qui contient tout le système. Je vous invite à ne pas y toucher à
moins que vous sachiez exactement ce que vous faites.

## /boot/carnotzet.cfg

Ici vous allez pouvoir configurer les interfaces réseau et il en existe de deux
types. Il y a l'interface filaire (wired) ainsi que l'interface sans fil (WiFi).
La configuration par défaut active uniquement l'interface filaire (en mode
DHCP).

Dans le cas du Raspberry Pi 4B, il faut savoir que l'interface sans fil
nécessite un firmware distribué uniquement sous la forme binaire par Broadcom.
Ce firmware est disponible avec les images de **Carnotzet OS**. Mon conseil est
que si vous pouvez privilégier l'interface filaire, alors ne vous embarrassez
pas avec le WiFi.

| Paramètre                      | Valeur par défaut   | Exemple                                                                      |
| ------------------------------ | ------------------- | ---------------------------------------------------------------------------- |
| _Filaire_                      |                     |                                                                              |
| `network_wire`                 | `eth0`              | `network_wire="eth0"`                                                        |
| `network_wire_dhcp`            | `[on] / off`        | `network_wire_dhcp="off"`                                                    |
| `network_wire_ip`              | `undefined`         | `network_wire_ip="192.168.1.100"`                                            |
| `network_wire_mask`            | `undefined`         | `network_wire_mask="24"`                                                     |
| `network_wire_gw`              | `undefined`         | `network_wire_gw="192.168.1.3"`                                              |
| `network_wire_dns`             | `undefined`         | `network_wire_dns="1.1.1.1 8.8.8.8"`                                         |
| _Sans fil_                     |                     |                                                                              |
| `network_wifi`                 | `undefined`         | `network_wifi="wlan0"`                                                       |
| `network_wifi_mode`            | `[wpa] / ap`        | `network_wifi_mode="ap"`                                                     |
| `network_wifi_dhcp`            | `[on] / off`        | `network_wifi_dhcp="off"`                                                    |
| `network_wifi_ip`              | `undefined`         | `network_wifi_ip="192.168.2.100"`                                            |
| `network_wifi_mask`            | `undefined`         | `network_wifi_mask="24"`                                                     |
| `network_wifi_gw`              | `undefined`         | `network_wifi_gw="192.168.2.1"`                                              |
| `network_wifi_dns`             | `undefined`         | `network_wifi_dns="1.1.1.1 8.8.8.8"`                                         |
| `network_wifi_dnsmasq_address` | `undefined`         | `network_wifi_dnsmasq_address="/#/192.168.42.1"`                             |
| `network_wifi_dnsmasq_dhcp`    | `undefined`         | `network_wifi_dnsmasq_dhcp="192.168.42.10,192.168.42.254,255.255.255.0,15m"` |
| `wifi_ssid`                    | `MyWifiNetworkSSID` | `wifi_ssid="maison"`                                                         |
| `wifi_password`                | `MyPassword`        | `wifi_password="1234"`                                                       |
| `wifi_country`                 | `CH`                | `wifi_country="GB"`                                                          |

Pour qu'une interface soit activée, il faut obligatoirement définir le premier
paramètre `network_wire` et (ou) `network_wifi`. Les autres paramètres sont tout
à fait ordinaires. Si vous avez des doutes alors gardez les paramètres `dhcp`
des interfaces que vous souhaitez activer, à `"on"`.

### Interface sans fil

Deux modes s'offrent à vous pour le sans fil. Le mode `wpa` permet de simplement
connecter **Carnotzet OS** à un réseau sans fil existant. Par défaut, en
activant simplement l'interface avec `network_wifi="wlan0"` et en configurant le
`wifi_ssid` ainsi que le `wifi_password`, le système se connectera simplement en
DHCP comme n'importe quel client sans fil. Si vous désirez utiliser une adresse
IP fixe, désactivez le DHCP et renseignez tous les paramètres suivants :
`network_wifi_ip`, `network_wifi_mask`, `network_wifi_gw` et `network_wifi_dns`.

**Captive Portal**

Le second mode est réservé aux spécialistes. Il permet de transformer
**Carnotzet OS** en point d'accès de type Captive Portal. Une page neutre, par
défaut, sera automatiquement servie à tous les clients qui se connecteront sur
ce point d'accès. Attention, en activant ce mode, votre interface `wlan0` ne
pourra plus être utilisée pour se connecter à un réseau sans fil existant.

Pour activer le mode Captive Portal, il faut spécifier la valeur `ap` au
paramètre `network_wifi_mode`. Vous devez alors obligatoirement spécifier tous
les paramètres d'adresse IP statique `network_wifi_ip`, `network_wifi_mask`,
`network_wifi_gw` et `network_wifi_dns`. Étant donné que votre **Carnotzet OS**
devient un point d'accès, bien entendu il ne peut plus fonctionner en DHCP.
Notez bien qu'en mode `ap`, le paramètre `network_wifi_dhcp` est simplement
ignoré.

Le service [dnsmasq] est utilisé afin de rediriger automatiquement toutes les
requêtes sur une adresse IP, celle du `wlan0`. Ce service sert également de
serveur DHCP pour tous les clients sans fil qui se connectent sur votre portail.
Voici une configuration complète et fonctionnelle pour le portail captif :

| Paramètre                      | Exemple                                                                      |
| ------------------------------ | ---------------------------------------------------------------------------- |
| `network_wifi`                 | `network_wifi="wlan0"`                                                       |
| `network_wifi_mode`            | `network_wifi_mode="ap"`                                                     |
| `network_wifi_ip`              | `network_wifi_ip="192.168.42.1"`                                             |
| `network_wifi_mask`            | `network_wifi_mask="24"`                                                     |
| `network_wifi_gw`              | `network_wifi_gw="192.168.42.1"`                                             |
| `network_wifi_dns`             | `network_wifi_dns="192.168.42.1"`                                            |
| `network_wifi_dnsmasq_address` | `network_wifi_dnsmasq_address="/#/192.168.42.1"`                             |
| `network_wifi_dnsmasq_dhcp`    | `network_wifi_dnsmasq_dhcp="192.168.42.10,192.168.42.254,255.255.255.0,15m"` |
| `wifi_ssid`                    | `wifi_ssid="Carnotzet"`                                                      |
| `wifi_country`                 | `wifi_country="CH"`                                                          |

La page par défaut du portail se situe dans le répertoire `/var/httpd/www` sous
la forme d'un fichier `index.html`. Vous êtes libre de le modifier à votre
convenance.

## /boot/sources.list

Ce fichier doit parler à certains d'entre vous. Il a exactement le même nom que
celui du logiciel apt (Debian) et permet de déclarer la liste des sources de
paquets. Dans le cadre de **Carnotzet OS**, ces paquets ressemblent à des
paquets Debian, ils utilisent la même extension `.deb` mais ils ne sont pas
(plus) compatibles avec dpkg. C'est ici qu'intervient le gestionnaire de paquets
wpkg qui a été profondément modifié pour les besoins d'Xcraft (d'où la perte de
compatibilité avec dpkg).

En règle générale vous n'avez pas besoin de modifier cette liste. Par défaut
elle référence le dépôt de paquets officiel de **Carnotzet OS** et se présente
ainsi (pour le Raspberry Pi 4B) :

```sh
# Auto-generated sources.list file
wpkg https://carnotzet.xcraft.ch/ rpi4b/
```

### Sources des paquets

Les logiciels pour **Carnotzet OS** sont mis à disposition à travers des dépôts
de paquets. Par exemple, un serveur SSH est disponible dans un de ces dépôts et
peut alors, sur demande, être installé très simplement dans le système avec
l'aide du gestionnaire de paquets wpkg. À noter que tout le système (bootloader,
kernel, etc.) peut être maintenu à jour avec le gestionnaire de paquets.

## Tout est prêt

Dans ce cas, continuez avec le premier démarrage de **Carnotzet OS** en
consultant la section [Démarrage](/carnotzet/04.bootstrap.md).

[dnsmasq]: https://dnsmasq.org/doc.html
